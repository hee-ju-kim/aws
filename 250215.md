***AWS 클라우드 아키텍처***

**Region**

- ap-northeast-2 서울리전(Region, 기본 VPC 가상 네트워크)

**Availability Zone**

- ap-northeast-2a 가용영역(Availability Zone; AZ)
- a, b, c, d 4개 -> IDC, 기본 subnet

**EC2**

- CPU, 메모리같은거
- SG 보안그룹 -> 방화벽
- TCP (80 웹포트/ 22 ssh 열어줘야 접근가능)
- 인스턴스볼륨 -> EC2지울때 같이 삭제되기때문에 백업필요

**EBS(Elastic Block Store)**

- 영구볼륨(Persistant Volumn/PV) -> 디스크
- SSD/HDD같은거
- EC2, EBS는 분리되어있음 -> 내부네트워크로 연결해서 사용(같은 가용영역에 있어야 사용가능)

*EBS와 Instanse volumn 비교문제 출제

----------------------
***aws콘솔***

1. 설정
- 현지화 및 기본 리전 설정 가능

2. 가입일 확인
- 청구서 -> 결제기간 selectbox 확인하기

3. 계정 설정
	1. 계정 해지
 		- 계정 해지시 서비스 다 삭제 후 해지하기(90일 후에 해지됨)
	2. 리전 활성화
	3. 결제 관련 IAM 활성화
 
----------------------
***CloudShell***

- EC2 -> 클라우드쉘 실행
- 키페어를 공공PC에 저장하지않고 CloudShell을통해 AWS계정의 클라우드에 저장해서 접근 가능
- 자격증명을 하지 않았음에도 높은 권한을 가지게됨
- 세션끊김
- df -h 파티션 보기
- 프롬포트 바꾸기
	- vi .bashrc
 	- export PS1='[\u@\h \W]\$ '
	- exit
- 키페어 만들기
	- aws ec2 create-key-pair --key-name my-key --query 'KeyMaterial' --output text > my-key.pem
- Region안에 있는데 VPC안에있는건 아님 -> Public IP로 접근가능
- ssh-i *pem ec2-user@퍼블릭 ip -> public ip로 ec2에 접근(펨키사용)
	- chmod 400 > 펨키 퍼미션 변경(본인만 읽을수있게)

----------------------
***EC2생성***

0. EC2(Elastic Compute Cloud)
- Compute -> CPU, RAM

1. 인스턴스 시작(Launch)
- 식별자
- 운영체제
- 인스턴스 유형(CPU,메모리)
- 키페어 > 위에서 만든 키페어
- 네트워크
  	> 네트워크 : 기본 VPC<br>서브넷 : 네트워크를 나눠놓은거<br>방화벽: ssh/http/https 허용

2. Public IP(pub)
- 외부와 통신하는 IP
- Internet Gateway안에 있음

3. Private IP(put/pri)
- VM안에 운영체제 수준으로 셋팅 -> 인스턴스 안에 있음
- 172.31.0.0

=> public IP와 private IP는 1:1 NAT 되어있음

*웹서버 기동<br>
sudo dnf install -y httpd<br>
sudo systemctl enable --now httpd<br>

*ip a = ip address 정보 출력<br>
*sudo timedatectl set-timezone Asia/Seoul<br>

----------------------
***VPC생성***

1. VPC
- my-vpc
- IP: 10.0.0.0/16
- 자동생성: DHCP/기본라우팅테이/기본네트워크ACL/SG
- VPC설정 후 VPC 설정 편집
	- DNS 호스트 이름 활성화(기본VPC는 퍼블릭IPv4 DNS가 생성되는데 내가 만든 VPC는 VPC설정에서 DNS활성화 true해줘야 DNS가 생성됨)

2. 서브넷
- VPC ID 선택
- 서브넷설정
10.0.0.0/16 my-vpc     (10.0.0.0, 10.0.0.1 ~ 10.0.255.254, 10.0.255.255)<br>
10.0.0.0/20 my-pub-2a  (10.0.0.0, 10.0.0.1 ~ 10.0.15.254, 10.0.15.255)<br>
10.0.16.0/20 my-pub-2b (10.0.16.0, 10.0.16.1 ~ 10.0.31.254, 10.0.31.255)<br>
10.0.32.0/20 my-pub-2c (10.0.32.0, 10.0.32.1 ~ 10.0.47.254, 10.0.47.255)<br>
10.0.48.0/20 my-pub-2d (10.0.48.0, 10.0.48.1 ~ 10.0.63.254, 10.0.63.255)<br>

3. 인터넷 게이트웨이
- 외부/내부를 연결하는 관문
- my-igw
- VPC에 연결에서 새로 만든 VPC에 연결해서 상태를 Attached로 바꿔줘야함

4. 라우팅 테이블
- 규칙
- private, public 연결
- 자동으로 생성된 라우팅테이블의 네임태그 수정 > my-pub-rtb
- 라우팅정보 추가
	1) 0.0.0.0/0(Anywhere)
	2) 인터넷 게이트웨이
	3) 생성 및 연결한 igw 선택 

5.FW 방화벽
- Network ACL(NACL)
- Security Group(SG)

* 내가만든 VPC에 EC2 생성
- 인스턴스 생성시 네트워크 설정에서 default VPC말고 생성한 VPC를 선택해서 생성하면 됨
- 서브넷 설정시 인스턴스 유형이 바뀔 수 있으니 유의
- 웹서비스 이용시 퍼블릭 IP 자동할당을 활성화로 바꿔야함
- 고급설정 - 사용자 데이터
  > EC2만들어질때 자동 실행함(루트권한으로 실행하기때문에 sudo가 없어도됨)

#!/bin/bash<br>
timedatectl set-timezone Asia/Seoul<br>
dnf install -y httpd<br>
systemctl enable --now httpd<br>
echo "seoul" > /var/www/html/index.html<br>

* ping 퍼블릭DNS시 핑안감 -> 보안그룹설정 필요
- EC2 > 네트워크 및 보안 > 보안그룹
- 인스턴스에 연결된 보안그룹 선택
- 인바운드 규칙 편집
- 모든 ICMP - IPv4 / Anywhere-IPv4 추가

----------------------
***VPC Peering***
