## Route53

**DNS 서비스**
> IP로 DNS로 매핑하거나 반대의 상황일 때 변환하여 트래픽을 웹 사이트로 라우팅<br>
> DNS resolver가 도메인의 정보를 알고있기 때문에 요청자에게 original ip로 응답<br>
> DNS resolver는 TTL(Time To Live) 생명주기 내에서 캐시로 정보를 저장<br>
> DNS resolver에서 IP를 모를경우 재귀적 리쿼시브 쿼리를 통해서 Root name sever로 ip요청<br>
> 위에서도 모를경우 TLD(Top level domain >> test.com에서 .com)서버에서 물어봄<br>
> TLD에서 Route53한테 물어보면서 최종적으로 웹 브라우저한테 IP를 알려줌<br>

**호스팅 영역**<br>
NS > Name Server<br>
SOA > 권한의 시작<br>

**타사에서 도메인을 사서 매핑하는 경우**<br>
호스팅하기 > 타사에서 구매한 도메인 등록<br>
호스팅된 영역 세부정보에서 NS에 생긴 값/트래픽 라우팅 대상 4가지를 맨 마지막 .제외하고 도메인의 NS에 복붙 등록<br>
CMD에 NS전파된거 확인하기<br>

**CMD**<br>
nslookup -type=ns 도메인 >> NS 전파된거 확인 가능

**레코드 생성**
IP와 도메인을 연결<br>

1. 생성
  - 레코드 생성 버튼 클릭
  - 레코드 이름
  - 레코드 유형
    - A: IPv4 - 도메인
    - AAAA: IPv6 - 도메인
    - CNAME: 도메인 - 도메인
    - MX: 메일서버
    - PTR: 도메인을 IP에 매핑하는게 보통이지만 반대로 IP에 매핑된 도메인을 확인
  - 값에 IP정보 입력
  - 레코드 생성 버튼 클릭


### CloudFormation
AWS 자동화 도구

1. 생성<br>
    1) 스택 생성<br>
       - 스택 생성 버튼<br>
       - 기존 템플릿 선택<br>
       - 템플릿 파일 업로드<br>
       - 파일 업로드 > 자동으로 S3 버킷 생성 후 파일 업로드<br>
    2) 스택 세부 정보 지정<br>
      - 스택 이름<br>
    3) 스택 옵션 구성<br>
    4) 검토 및 작성<br>

2. 제거
  - 삭제할 템플릿 선택<br>
  - 삭제버튼 클릭<br>

## EC2

중지 후 재실행시 퍼블릭IP가 바뀜 > 바뀌지 않게 하고싶으면 탄력적IP설정하면 됨(유료)<br>

리눅스일경우<br>

/dev/sda1<br>
/dev/sdh<br>
/dev/sdj<br>
/dev/sdb<br>

  dev
    - 디바이스
    
  sd(*)(숫자)<br>
    - 장치 파일명<br>
    - 장치 파일명과 폴더를 마운트 해야 사용가능<br>
    - *부분은 드라이버<br>
    - 숫자는 파티션 넘버<br>
    - a드라이버 > 루트<br>

**instance store**<br>
  - 임시 저장공간
  - ec2와 붙어있음 > 메인보드에 붙어있는 느낌
  - ec2가 지워지면 함께 지워짐 > 데이터 남기고싶으면 백업해야함
  - EBS보다 성능 좋음 > 빠른 IO를 사용할때 좋음

**CloudShell에 파일 업로드**

*aws.tar 전송

1. 작업 > 파일 업로드 > 파일선택
> 업로드하면 접속한 서버가 아닌 클라우드쉘에 업로드됨(클라우드쉘에서 접속한 서버에는 파일 올릴 수 없음)

2. 서버에 파일 전송
scp -i 펨키 보낼파일 리눅스사용자@도메인:/home/ec2-user/

3. tar 해제
sudo tar xvf aws.tar -C /var/www//html/

## EBS(Elastic Block Store) 볼륨
인스턴스에 사용할 수 있는 블록수준 스토리지 볼륨

**EC2와 EBS의 관계**<br>
EC2(CPU, RAM) - EBS(디스크) >> 네트워크(물리적)로 연결(같은 가용영역에 있어야함)<br>

Instance store보다 성능이 떨어질 수 있으나 EC2가 삭제되었을시 영구볼륨(PV/ Persistant Volume)으로 데이터가 지워지지 않음 ex) DB<br>

Attach/Dettach가능<br>

**EBS볼륨**<br>
스냅샷ID가 같은이유는 같은 OS가 설치되어있기때문<br>

* lsblk > 내 블록 스토리지 목록
* df -Th > T: type / h: 현재 사용량/남은용량/마운트 정보

1. 생성
    - 볼륨 생성
    - 유형 > 디스크 성능
    - 크기
    - IOPS > 초당 IO 갯수 > 유형에 맞게 디폴트 셋팅이 들어감(수정가능)
    - 가용영역 > EC2 가용영역에 맞게

2. 연결
    - 볼륨선택 후 작업 > 볼륨연결 선택
    - 인스턴스 선택
    - 디바이스 이름 > 루트는 사용되어있어서 b부터 사용가능
    - 연결했다고 바로 사용 가능하지 않음 > 포맷 후 마운트 해야함

3. 디스크 포맷
    - sudo mkfs -t ext4 /dev/xvdb
      > sudo 붙여야함 / dev는 device의 dev<br>
    - 맨 처음에만 해야함(스냅샷을 이용해 만든 볼륨일 경우 포맷하면 데이터가 사라지니 포맷하면 안됨)

4. 마운트
    - 최상위 mnt폴더에서 마운트 가능 > a디스크에 있는데 마운트 하면 b디스크에 저장됨
    - sudo mount /dev/xvdb /mnt
    - 위 명령어 후 df -Th 명령어로 확인하면 /dev/xvdb가 목록에 출력됨

5. 마운트 해제
    - sudo umount /mnt
   
* 볼륨 추가 후 파일 옮기기
sudo mv aws.tar /mnt

**스냅샷**<br>
EBS 복사본<br>
EBS와 EC2가 다른 AZ에 있을경우 둘이 연결할 수 없음 > 스냅샷으로 연결하여 사용할 수 있음<br>

**스냅샷 형태**
1. 볼륨 생성
  - AZ변경 가능
  - 생성 프로세스
      1) EBS에서 복사할 볼륨 선택 후 스냅샷 생성
      2) 디폴트로 스냅샷 생성 >> EBS와 동일한 크기로 생성
      3) 스냅샷 메뉴로 이동
      4) 스냅샷 선택 후 작업 > 볼륨 생성 (스냅샷을 볼륨으로 만드는 과정)
      5) 가용영역을 **2c**로 선택(원래 볼륨이 2a였음)
      6) 생성 후 볼륨 대시보드에서 확인
      
2. 복사 기능
  - 전송(타 리전으로 전송가능)
      - 타 리전으로 전송 가능
      - 증분식(추가된 데이터에 관해서만)으로 데이터 전송 가능
  - 백업
  - 복사 프로세스
      1) 스냅샷 선택 후 복사
      2) 대상 리전에서 타 리전 선택
      3) 스냅샷 복사
    
3. 이미지
    - 오토스케일링

**루트볼륨 용량늘리기**
용량을 작게 수정은 X >> 수정할때 신중하게 수정해야함<br>

1. 수정<br>
    1) 볼륨 선택 > 수정<br>
    2) 용량 수정<br>
    3) sudo growpart /dev/xvda 1 >> 파티션 크기 키우기
    4) sudo xfs_growfs -d / >> 마운트된 공간 용량 키우기

## IAM
IAM(Identity and Access management): 인증 권한<br>

IAM User > 특정 유저<br>
IAM Groups > 그룹(개발자/dev, 운영자/ops 등등)<br>
IAM Roles > 권한들의 집합, 서비스가 주체 ex) ec2에게 s3권한을 부여할때, lamda등등<br>

**IAM Groups**
1. 사용자 그룹 생성
    1) IAM에서 사용자그룹 > 생성
    2) 그룹명 생성
    3) 권한 > ec2검색
    4) AmazonEC2ReadOnlyAccess > EC2 읽기전용만 체크

2. 사용자
    1) 사용자 생성
    2) 이름 hjTest
    3) AWS Management Console에 대한 사용자 액세스 권한 제공 – 선택 사항 체크
    4) IAM 사용자를 생성하고싶음 체크
    5) 자동 생성된 암호
    6) 사용자 다음 로그인시 새 암호 생성 체크
    7) 사용자 그룹에 넣기
    8) 사용자 생성

* AWS 계정 AWSID에대한 별칭 만들기<br>
IAM 대시보드 > 계정 별칭

3. 권한 추가하기
    1) 사용자그룹
    2) admin 선택 후 권한 클릭
    3) 권한정책 선택 후 삭제
    4) 권한 추가 > 정책 연결
    5) 추가할 권한 체크 후 정책연결


## RDS(Relational Database Service)
완전 관리형 서비스 > 자동백업(크론탭), 고가용성 셋팅(갈레라 클러스터), 자동조정(오토스케일링)을 알아서 해줌<br>
RDS는 퍼블릭 아이피를 주지 않는다 > 다이렉트로 DB서버 접근 불가능 / 접속시도를 막아야되기때문


1. 실습
    1) APM -> Apache Php MariaDB
    2) 2티어 구성
